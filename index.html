<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3D Viewer ‚Äî Pro</title>

  <!-- Import map for bare specifier "three" -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js"
    }
  }
  </script>

  <!-- FontAwesome icon font (used by inspector toggles) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- JSZip for ZIP texture loading -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <!-- TGA-js - standalone TGA loader for browser -->
  <script src="/src/utils/tga-js.js"></script>
  <script>console.debug('[index.html] TGALoader global:', typeof TGALoader !== 'undefined');</script>

  <link rel="stylesheet" href="src/style.css" />
</head>
<body class="preload">
  <div class="viewer-wrap" id="drop-zone" aria-label="3D Viewer">
    <canvas class="viewer-canvas" id="viewport" tabindex="0"></canvas>
  </div>

  <aside class="left-col" aria-label="Controls">
    <header>
      <span class="logo-dot" aria-hidden="true"></span>
      <h1 data-i="title">3D Viewer</h1>
      <button id="theme-toggle" class="theme-switch" title="Theme">
        <span class="icon" id="theme-icon">üåû</span>
        <span id="theme-label">Light</span>
      </button>
      <select id="lang" class="field lang-select">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="en">English</option>
      </select>
    </header>

    <div class="group">
      <div class="toolbar">
        <label class="btn">
          <input id="file-input" type="file" accept=".gltf,.glb,.fbx,.obj,.bin,.dae,.vrm,.zip" hidden />
          <span data-i="btnLoad">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å</span>
        </label>
        <button id="reset-camera" class="btn secondary" data-i="btnFrame">–ö –∫–∞–º–µ—Ä–µ</button>
        <button id="clear-scene" class="btn danger" data-i="btnClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button id="reset-all" class="btn secondary" data-i="btnResetAll">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
      </div>

      <div class="row">
        <label class="toggle"><input type="checkbox" id="toggle-shadows" /><span data-i="toggleShadows">–¢–µ–Ω–∏</span></label>
        <label class="toggle"><input type="checkbox" id="toggle-fxaa" checked /><span>FXAA</span></label>
        <label class="toggle"><input type="checkbox" id="toggle-lightonly" /><span data-i="toggleLight">–¢–æ–ª—å–∫–æ –æ—Å–≤–µ—â–µ–Ω–∏–µ</span></label>
        <label class="toggle"><input type="checkbox" id="toggle-grid" checked /><span data-i="toggleGrid">–°–µ—Ç–∫–∞</span></label>
      </div>

      <div class="row">
        <label data-i="bgLabel">–§–æ–Ω</label>
        <select id="bg-select" class="field">
          <option value="white" selected>–ë–µ–ª—ã–π</option>
          <option value="lightgray">–°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π</option>
          <option value="midgray">–°—Ä–µ–¥–Ω–µ-—Å–µ—Ä—ã–π</option>
          <option value="darkgray">–¢—ë–º–Ω—ã–π</option>
          <option value="transparent">–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π</option>
          <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π</option>
        </select>
        <input id="bg-color" class="field" type="color" value="#ffffff" title="Custom" />
      </div>

      <div class="row">
        <label>HDRI</label>
        <input class="field" type="text" id="hdri-url" placeholder="URL .hdr" />
        <button id="apply-hdri" class="btn" data-i="btnApply">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      </div>

      <div class="row">
        <label>–¢–µ–∫—Å—Ç—É—Ä—ã</label>
        <input id="texture-input" type="file" accept=".zip" hidden />
        <label for="texture-input" class="btn" data-i="btnLoad">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—ã</label>
        <button id="apply-textures" class="btn" data-i="btnApply">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—ã</button>
      </div>

      <!-- Moved up: Material/Wireframe always visible -->
      <div class="row">
        <label data-i="matOverride">–ú–∞—Ç–µ—Ä–∏–∞–ª</label>
        <select id="mat-override" class="field">
          <option value="none" selected>–û—Ä–∏–≥–∏–Ω–∞–ª</option>
          <option value="standard">Standard</option>
          <option value="phong">Phong</option>
          <option value="basic">Basic</option>
          <option value="normal">Normal</option>
          <option value="toon">Toon</option>
        </select>
        <label class="toggle"><input type="checkbox" id="toggle-wireframe" /><span data-i="wireframe">–ö–∞—Ä–∫–∞—Å</span></label>
      </div>

      <div class="split"></div>

      <!-- Collapsible: Render -->
      <details class="section" data-sec="render">
        <summary><span class="summary-title">Render</span><span class="chev">‚ñæ</span></summary>
        <div class="section-body">
          <div class="row">
            <label>Exposure</label>
            <input id="exposure" class="range" type="range" min="0" max="4" step="0.01" value="1" />
            <span class="small" id="exposure-val">1.00</span>
          </div>
          <div class="row">
            <label>Tone mapping</label>
            <select id="tone-mapping" class="field">
              <option value="ACES" selected>ACES</option>
              <option value="Linear">Linear</option>
              <option value="Reinhard">Reinhard</option>
              <option value="Cineon">Cineon</option>
              <option value="Neutral">Neutral</option>
              <option value="None">None</option>
            </select>
          </div>
          <div class="row">
            <button id="reset-render" class="btn secondary" data-i="btnReset">–°–±—Ä–æ—Å–∏—Ç—å</button>
          </div>
        </div>
      </details>

      <!-- Collapsible: Directional light -->
      <details class="section" data-sec="dirlight">
        <summary><span class="summary-title">Directional light</span><span class="chev">‚ñæ</span></summary>
        <div class="section-body">
          <div class="row">
            <label>Intensity</label>
            <input id="dir-intensity" class="range" type="range" min="0" max="5" step="0.01" value="0.9" />
            <span class="small" id="dir-intensity-val">0.90</span>
          </div>
          <div class="row">
            <label>Angle</label>
            <input id="dir-angle" class="range" type="range" min="0" max="360" step="1" value="34" />
            <span class="small" id="dir-angle-val">34¬∞</span>
          </div>
          <div class="row">
            <label>Softness</label>
            <input id="dir-softness" class="range" type="range" min="0" max="4" step="0.1" value="1" />
            <span class="small" id="dir-softness-val">1.0</span>
          </div>
          <div class="row">
            <button id="reset-dir" class="btn secondary" data-i="btnReset">–°–±—Ä–æ—Å–∏—Ç—å</button>
          </div>
        </div>
      </details>

      <!-- Collapsible: Environment -->
      <details class="section" data-sec="environment">
        <summary><span class="summary-title">Environment</span><span class="chev">‚ñæ</span></summary>
        <div class="section-body">
          <div class="row">
            <label>Env intensity</label>
            <input id="env-intensity" class="range" type="range" min="0" max="4" step="0.01" value="1" />
            <span class="small" id="env-intensity-val">1.00</span>
          </div>
          <div class="row">
            <button id="reset-env" class="btn secondary" data-i="btnReset">–°–±—Ä–æ—Å–∏—Ç—å</button>
          </div>
        </div>
      </details>

      <!-- Collapsible: Gizmos & measurements -->
      <details class="section" data-sec="gizmos">
        <summary><span class="summary-title">Gizmos & measurements</span><span class="chev">‚ñæ</span></summary>
        <div class="section-body">
          <div class="row">
            <label class="toggle"><input type="checkbox" id="toggle-transform"/><span>Gizmo</span></label>
            <select id="transform-mode" class="field">
              <option value="translate" selected>Translate</option>
              <option value="rotate">Rotate</option>
              <option value="scale">Scale</option>
            </select>
            <label class="toggle"><input type="checkbox" id="toggle-snap"/><span>Snap</span></label>
          </div>
          <div class="row">
            <label>ŒîPos</label><input id="snap-pos" class="field" type="number" step="0.01" value="0.1" style="width:80px" />
            <label>ŒîRot¬∞</label><input id="snap-rot" class="field" type="number" step="1" value="15" style="width:80px" />
            <label>ŒîScale</label><input id="snap-scale" class="field" type="number" step="0.01" value="0.1" style="width:80px" />
          </div>
          <div class="row">
            <button id="measure-toggle" class="btn">Measure</button>
            <button id="measure-clear" class="btn secondary">Clear</button>
            <span class="tag" id="measure-out">‚Äî</span>
          </div>
          <div class="row">
            <button id="reset-gizmos" class="btn secondary" data-i="btnReset">–°–±—Ä–æ—Å–∏—Ç—å</button>
          </div>
        </div>
      </details>

      <!-- Collapsible: Camera -->
      <details class="section" data-sec="camera">
        <summary><span class="summary-title">Camera</span><span class="chev">‚ñæ</span></summary>
        <div class="section-body">
          <div class="row" id="cam-presets">
            <button class="btn" data-view="front">Front</button>
            <button class="btn" data-view="back">Back</button>
            <button class="btn" data-view="left">Left</button>
            <button class="btn" data-view="right">Right</button>
            <button class="btn" data-view="top">Top</button>
            <button class="btn" data-view="bottom">Bottom</button>
            <button class="btn" data-view="iso">Iso</button>
          </div>
        </div>
      </details>

      <!-- Collapsible: Animations -->
      <details class="section" data-sec="anim">
        <summary><span class="summary-title" data-i="animTitle">–ê–Ω–∏–º–∞—Ü–∏–∏</span><span class="chev">‚ñæ</span></summary>
        <div class="section-body">
          <div class="row" id="anim-row">
            <select id="anim-select" class="field" style="min-width:200px"></select>
            <button id="anim-playpause" class="btn ok" data-i="animPlay">–ü—É—Å–∫</button>
            <button id="anim-stop" class="btn" data-i="animStop">–°—Ç–æ–ø</button>
            <label class="toggle"><input type="checkbox" id="anim-loop" checked /><span data-i="animLoop">–ó–∞—Ü–∏–∫–ª–∏—Ç—å</span></label>
            <label class="row small">
              <span data-i="animSpeed">–°–∫–æ—Ä–æ—Å—Ç—å</span>
              <input id="anim-speed" class="field" type="number" step="0.25" min="0.25" max="3" value="1" style="width:70px" />
              <span>x</span>
            </label>
          </div>
          <div class="row">
            <input id="anim-progress" class="range" type="range" min="0" max="1" step="0.001" value="0" />
            <span class="small" id="anim-time">0.00 / 0.00s</span>
          </div>
          <div class="small" data-i="animHint">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–Ω–∏–º–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è.</div>
        </div>
      </details>
    </div>

    <div class="split"></div>

    <div class="group scroll" style="min-height: 0">
      <label class="small" data-i="hotkeys">–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</label>
      <div class="row small">
        <span class="kbd">LMB</span> <span data-i="hkSelect">–≤—ã–±–æ—Ä</span>
        <span class="kbd">F</span> <span data-i="hkFocus">–∫ –æ–±—ä–µ–∫—Ç—É</span>
        <span class="kbd">R</span> <span data-i="hkReset">—Å–±—Ä–æ—Å –∫–∞–º–µ—Ä—ã</span>
        <span class="kbd">Del</span> <span data-i="hkClearSel">—Å–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ</span>
      </div>
      <div class="row small">
        <label data-i="movementSensitivity">–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è</label>
        <input id="movement-sensitivity" class="range" type="range" min="0.1" max="50" step="0.1" value="5.0" style="width:120px" />
        <span class="small" id="movement-sensitivity-val">5.0</span>
        <span class="small" data-i="movementSensitivityHint" title="–†–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ —Ä–∞—Å–∫–ª–∞–¥–∫–∞–º–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã">üåê</span>
      </div>
    </div>
  </aside>

  <aside id="scene-inspector" class="inspector right-[-360px]" aria-label="Scene Inspector">
    <header>
      <strong data-i="inspector">–°—Ü–µ–Ω–∞</strong>
      <div class="row">
        <span class="tag" id="poly-count">‚Äî</span>
        <span class="tag" id="bbox-size">bbox: ‚Äî</span>
        <button class="btn" id="inspector-close" data-i="btnHideInspector">–°–∫—Ä—ã—Ç—å</button>
      </div>
    </header>
    <div class="tree" id="tree"></div>
  </aside>

  <button class="open-inspector-tab" id="open-inspector" title="Inspector">‚ò∞</button>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <div class="overlay" id="overlay">
    <div class="progress">
      <h3 id="progress-title">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</h3>
      <div class="meter indeterminate" id="meter"><i></i></div>
      <div class="small" id="progress-sub">–û–∂–∏–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ‚Ä¶</div>
    </div>
  </div>

  <div class="debug" id="debug-bar">
    <div class="chip"><b>FPS:</b> <span id="fps">‚Äî</span></div>
    <div class="chip"><b data-i="objects">–û–±—ä–µ–∫—Ç—ã:</b> <span id="obj-count">‚Äî</span></div>
  </div>
<script type="module" src="./src/app.js"></script>
</body>
</html>